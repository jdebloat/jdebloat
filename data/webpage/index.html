<!doctype html>
<html>
<head>

<meta charset="UTF-8">
<title>Debloat Project</title>
<link href="aboutPageStyle.css" rel="stylesheet" type="text/css">

<!--The following script tag downloads a font from the Adobe Edge Web Fonts server for use within the web page. We recommend that you do not modify it.-->
<script>var __adobewebfontsappname__="dreamweaver"</script><script src="http://use.edgefonts.net/montserrat:n4:default;source-sans-pro:n2:default.js" type="text/javascript"></script>
</head>

<body>
<!-- Header content -->
<header>
  <div class="profileLogo"> 
    <!-- Profile logo. Add a img tag in place of <span>. -->
    </div>
  <div class="profilePhoto"> 
	  <!-- Profile photo -->
	  <img src="onr.png" alt="sample" width="100%">
  </div>
  <!-- Identity details -->
  <div class="profileHeader">
    <h1>ONR Debloat Project</h1>
    <h3>University of California, Los Angeles</h3>
    <hr>
    <p>

Welcome to our ONR Debloat project webpage.
<br>
<a href="./people.html">See the people involved in the ONR Debloat project here.</a>
<br>
<a href="./onr_debloat.tar.gz" download>Download the ONR tools here.</a>
<br>

    </p>
  </div>
</header>
<!-- content -->
<div class="mainContent"> 
 
  <section class="section2">
    <h2 class="sectionTitle">Debloat Tool</h2>
    <hr class="sectionTitleRule">
    <hr class="sectionTitleRule2">
    <div class="section2Content">

<p>The <code>debloat.jar</code> takes a java project and attempts to remove unused
methods and classes based on Call Graph analysis and, if specified,
<a href="https://doi.org/10.1145/1985793.1985827">TamiFlex</a> reflection call
analysis.</p>

<h2 id="technicaldetails">Technical Details</h2>

<p>The Debloat tool works by generating a call graph of the input program.
It then proceeds to remove methods that are not utilized within it. The
user is required to specify entry points to this call graph. We provide
 three pre-programmed options : all main methods, all public methods
(excluding tests), and/or all JUnit Tests. The user may also specify custom
entry point/points if required.</p>

<p>Using the
<a href="https://doi.org/10.1145/1925805.1925818">Soot Bytecode optimization framework
</a>
we wipe unused methods. The user has the option of either
completely removing the method, removing the method's body, or
replacing the method's body with a RuntimeException.</p>

<p>Due to
<a href="https://en.wikipedia.org/wiki/Reflection_(computer_programming)#Java">Java's Reflection functionality
</a>
Spark is incapable of creating a complete call graph. To overcome this
we use <a href="https://doi.org/10.1145/1985793.1985827">TamiFlex</a>. TamiFlex
observes the execution of a Java program and notes the reflective
method invocations (their locations within the Java application, and
what they invoke).</p>

<p>Our Debloat tool runs TamiFlex with the target Java project's tests as
input. We then extract all the method invocations achieved via
reflection. We set these as entry points for the  call graph
analysis. This thereby results in a safer debloating.</p>

<h2 id="usage">Usage</h2>

<p>To execute our debloat tool with the benchmarks provided, simply run
<code>make debloat</code>. The debloated programs, can be found in
<code>output/debloat</code>.</p>

<p>If running the tool independently directory is required, please read the
follwing usage notes:</p>

<pre><code>usage: debloat.jar [-a &lt;arg&gt;] [-c &lt;arg&gt;] [-d] [-e &lt;Exception Message&gt;] [-f
       &lt;TamiFlex Jar&gt;] [-h] [-i &lt;arg&gt;] [-k] [-l &lt;arg&gt;] [-m] [-n &lt;arg&gt;]
       [-o] [-p] [-r] [-s] [-t &lt;arg&gt;] [-u] [-v]

An application to get the call-graph analysis of an application and to
wipe unused methods

 -a,--app-classpath &lt;arg&gt;                     The application classpath

 -c,--custom-entry &lt;arg&gt;                      Specify custom entry points
                                              in syntax of
                                              '&lt;[classname]:[public?]
                                              [static?] [returnType]
                                              [methodName]([args...?])&gt;'

 -d,--debug                                   Run the program in 'debug'
                                              mode. Used for testing

 -e,--include-exception &lt;Exception Message&gt;   Specify if an exception
                                              message should be included
                                              in a wiped method (Optional
                                              argument: the message)

 -f,--tamiflex &lt;TamiFlex Jar&gt;                 Enable TamiFlex

 -h,--help                                    Help

 -i,--ignore-classes &lt;arg&gt;                    Specify class/classes that
                                              should not be delete or
                                              modified

 -k,--use-spark                               Use Spark (Uses CHA by
                                              default)

 -l,--lib-classpath &lt;arg&gt;                     The library classpath

 -m,--main-entry                              Include the main method as
                                              the entry point

 -n,--maven-project &lt;arg&gt;                     Instead of targeting using
                                              lib/app/test classpaths, a
                                              Maven project directory may
                                              be specified

 -n,--maven-project &lt;arg&gt;                     Instead of targeting using
                                              lib/app/test classpaths, a
                                              Maven project directory may
                                              be specified

 -o,--remove-classes                          Remove unused classes

 -p,--prune-app                               Prune the application
                                              classes as well

 -r,--remove-methods                          Run remove methods (by
                                              default, the bodies are
                                              wiped and replaced by
                                              RuntimeExceptions)

 -s,--test-entry                              Include the test methods as
                                              entry points

 -t,--test-classpath &lt;arg&gt;                    The test classpath

 -u,--public-entry                            Include public methods as
                                              entry points

 -v,--verbose                                 Run the program in 'verbose'
                                              mode. Outputs methods
                                              analysed and methods touched
</code></pre>

<p></p>

<p>Some current restrictions:</p>

<ul>
<li><p>There must be an entry point specified.</p></li>

<li><p>At present, the <code>--tamiflex</code> option only works when targeting a
Maven Project.</p></li>

<li><p>If the <code>--tamiflex</code> option is specified, the <code>--test-entry</code> option is
automatically set (tamiflex uses tests as entry points to analyze
reflective calls.</p></li>

<li><p><code>debloat.jar</code> only works with Java 1.8.</p></li>

<li><p><code>--use-spark</code> will use <a href="https://doi.org/10.1007/3-540-36579-6_12">Spark Call Graph
analysis</a>. Spark is not as
conservative an analysis as our default call graph analysis (CHA)  and
may cause errors (we know of instances where Spark does not produce a
complete call graph).</p></li>

<li><p>We do not take into account methods accessed via Java Lambda
Expressions. Therefore, it is possible we remove methods that are used
by the tool.</p></li>
</ul>

<h2 id="exampleusagecase1mavenprojectallentrypointswithtamiflex">Example usage case 1: Maven project, all entry points, with Tamiflex</h2>

<p>`java -jar debloat.jar --maven-project <PROJECT_DIR> --public-entry
--main-entry --test-entry --prune-app --remove-methods --tamiflex</p>

<p><TAMFLEX_JAR>`</p>

<p><code>--maven-project &lt;PROJECT_DIR&gt;</code> specifies the Maven project to be debloated.</p>

<p><code>--public-entry --main-entry --test-entry</code> states that all entry points
(all public, the main methods, and test methods) should be used as entry
points to generate the call graph.</p>

<p><code>--prune-app</code> specifies that that the application code should be
debloated as well as the dependency code.</p>

<p><code>--remove-methods</code> specifies that methods should be removed in their
entirety. By default, only their bodies are removed.</p>

<p><code>--tamiflex &lt;TAMIFLEX_JAR&gt;</code> specifies that TamiFlex should be used to find
reflective calls. The argument is the location of the TamiFlex Jar.</p>

<h2 id="exampleusagecase2nonmavenprojectmainentrypointwithouttamiflex">Example usage case 2: Non-Maven Project, main entry point, without Tamiflex</h2>

<p><code>java -jar debloat.jar --app-classpath &lt;APP_CLASSPATH&gt; --lib-classpath
&lt;LIBRARY_CLASSPATH&gt; --test-classpath &lt;TEST_CLASSPATH&gt;
--include-exception "ERROR, METHOD REMOVED"</code></p>

<p><code>--app-classpath &lt;APP_CLASSPATH&gt; --lib-classpath&lt;LIBRARY_CLASSPATH&gt;
--test-classpath &lt;TEST_CLASSPATH&gt;</code> specifies the application, library,
and test classpaths of the target.</p>

<p><code>--include-exception "ERROR, METHOD REMOVE"</code> specifies that when a
method's body is wiped it should be replaced with a Runtime exception
with the message "ERROR, METHOD REMOVE".</p>

<h2 id="exampleusagecase4mavenprojectwithsparkremoveunusedclass">Example usage case 3:  Maven project, with Spark, remove unused class</h2>

<p><code>java -jar debloat.jar --maven-project &lt;PROJECT_DIR&gt; --main-entry
--remove-classes --use-spark</code></p>

<p><code>--remove-classes</code> specifies that classes in which all methods are
removed, and contain no accessible static methods, are to be removed
completely.</p>

<p><code>--use-spark</code> specifies that Spark Call Graph analysis is to be used.</p>
   	</p>
   </div>

</section>

<section class="section2">
    <h2 class="sectionTitle">JReduce</h2>
    <hr class="sectionTitleRule">
    <hr class="sectionTitleRule2">
    <div class="section2Content">
	<h1 id="jreduce">JReduce</h1>

<p>JReduce is a tool that uses a variant of delta-debugging to reduce the
classes of a project given a property. The tool was originally build to
reduce the bytecode that caused bugs in decompilers. We categorized a
bug as any set of classes with no external dependencies, was not able to
decompile and then compile again. The goal was therefore to find the
smallest set of classes, that still had all their dependencies. This
work has been submitted to ICSE'19.</p>

<p>In this case, we use the test suite as the property that we want to
preserve and then reduce to the smallest set of classes we need.</p>

<h2 id="technicaldetails">Technical Details</h2>

<p>JReduce works by calculating a dependency graph from classes to other
classes. We create the graph by creating an edge from a class to another
if the second class is mentioned in the first.</p>

<p>We then calculate all the strongly connected components (SCC) in the
project. If we include one of the classes in an SCC, all classes in the
SCC needs to be included. This means that we can reduce the program, by
reducing this list of SCCs.</p>

<p>It is rare that a program runs outside the SCC that contains the main
class but can happens when the program uses reflection. We have
therefore developed a new reduction technique called <em>Binary Reduction</em>,
which can quickly search the list for a few SCC needed to satisfy the
predicate.</p>

<p>Our tool is also able to set a core. The core is code that should not be
removed. SCC that contains a class from the core will not be removed. In
our case, we set the test-cases as a core.</p>

<h2 id="usage">Usage</h2>

<p>To run JReduce on the benchmarks of this project, first install the
tool by running <code>stack install</code> in the <code>tools/jvmhs</code> folder.</p>

<p>Then run <code>make jreduce</code> and the output can be found in the
<code>output/jreduce</code> folder.</p>

<p>You can also run the tool on your own benchmarks. Either use
the <code>script/runjreduce.sh</code> script or you can run JReduce directly:</p>

<pre><code>jreduce -v -o output --cp test.jar -t app.jar -c @classes-in-core.txt \
  &lt;runpredicate&gt; &lt;args..&gt;
</code></pre>

<p>Where <code>runpredicate.sh</code> is a script that takes a reduced <code>app.jar</code> and
has exit code 0 if the predicate succeeded. In the <code>runjreduce.sh</code>
script we use <code>runtest.sh</code> with the <code>test.jar</code> and <code>test.classes.txt</code>.</p>

<p>In the case you want to be adventures; consult the help notes:</p>

<pre><code>Usage: jreduce [-v] [-q] [-D|--log-depth ARG] [-c|--core CORE] [--cp CLASSPATH]
               [--stdlib] [--jre JRE] (-t|--target FILE) (-o|--output FILE)
               [-R|--reducer ARG] [-W|--work-folder ARG] [-K|--keep-folders]
               [-E|--exit-code CODE] [--stdout] [--stderr] [-T|--timelimit SECS]
               CMD [ARG..]
  A command line tool for reducing java programs.

Available options:
  -v                       make it more verbose.
  -q                       make it more quiet.
  -D,--log-depth ARG       set the log depth. (default: -1)
  -c,--core CORE           the core classes to not reduce.
  --cp CLASSPATH           the library classpath, of things not reduced.
  --stdlib                 load the standard library.
  --jre JRE                the location of the stdlib.
  -t,--target FILE         the path to the jar or folder to reduce.
  -o,--output FILE         the path output folder.
  -R,--reducer ARG         the reducing algorithm to use. (default: Binary)
  -W,--work-folder ARG     the work folder.
  -K,--keep-folders        keep the work folders after use?
  -E,--exit-code CODE      preserve exit-code (default: 0)
  --stdout                 preserve stdout.
  --stderr                 preserve stderr.
  -T,--timelimit SECS      the maximum number of seconds to run the process,
                           negative means no timelimit. (default: -1.0)
  CMD                      the command to run
  ARG..                    arguments to the command.
  -h,--help                Show this help text
</code></pre>
	</div>
</section>

<section class="section2">
    <h2 class="sectionTitle">Inline Tool</h2>
    <hr class="sectionTitleRule">
    <hr class="sectionTitleRule2">
    <div class="section2Content">
    <p>The <code>inliner.jar</code> takes a Java program and statically inlines methods
    read from a database.</p>
    <h2 id="technicaldetails">Technical Details</h2>
    <p>We first provide aggressive inline parameters to the JVM. While these parameters
    are not suitable for running programs, they provide better inlining information. We
    extract the inlining decisions from the JVM into a database for later use.</p>

    <p>We use to our customized database to inform our static inliner. First, we filter out
    aggressive inlinings which would cause the Java program to miscompile. Using this information,
    our Inliner tool uses the Soot Bytecode optimization framework to statically inline method calls
    without affecting the semantics of the program.</p>

    <p>Our technique finds inline targets that might not otherwise be detectable by purely
    static approaches. Our tool produces a new JAR with our modified class files containing inlined
    methods. We successfully ran our modified JAR on the original tests cases without errors.</p>
    <h2 id="usage">Usage</h2>
    <p>To run the Inliner tool, simply run <code>make inliner</code>.</p>

    <p>The output programs will be found in output/inliner as jars. If running
    the tool independently is required, please read the following usage notes:</p>

    <pre><code>usage: run-inliner.py [-h] [-o OUTPUT_JAR]
                      test_jar test_classes app_lib_jar output_dir

Run inliner tool.

positional arguments:
  test_jar       JAR containing the test suite
  test_classes   Text file of test classes
  app_lib_jar    JAR containing application and libraries
  output_dir     Output directory

optional arguments:
  -h, --help     show this help message and exit
  -o OUTPUT_JAR  Modified JAR file path
    </code></pre>
    </div>
</section>
  
<!-- Contact details -->
  <section class="section1">
    <h2 class="sectionTitle">Contact Details</h2>
    <hr class="sectionTitleRule">
    <hr class="sectionTitleRule2">
    <div class="section1Content">
	    <p><span>Address :</span> <a href="https://www.openstreetmap.org/?mlat=34.069364&mlon=-118.444489&zoom=20">Engineering VI, 404 Westwood Plaza, Los Angeles, CA 90095</a></p>
    </div>
  </section>
</div>
<footer>
  <hr>
  <p class="footerNote">ONR Project</span></p>
</footer>
</body>
</html>
